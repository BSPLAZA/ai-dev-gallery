<?xml version="1.0" encoding="utf-8"?>
<UserControl
    x:Class="AIDevGallery.Controls.Evaluate.EvaluationListRow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="using:AIDevGallery.Controls.Evaluate"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    mc:Ignorable="d">
    
    <UserControl.Resources>
        <converters:BoolToVisibilityConverter x:Key="BoolToVisibilityConverter" xmlns:converters="using:AIDevGallery.Converters"/>
    </UserControl.Resources>

    <Grid Height="72" 
          Padding="16,12"
          Background="{x:Bind GetRowBackground(IsHovered, IsSelected), Mode=OneWay}"
          PointerEntered="OnPointerEntered"
          PointerExited="OnPointerExited"
          Tapped="OnRowTapped"
          DoubleTapped="OnRowDoubleTapped">
        
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="32"/>  <!-- Checkbox -->
            <ColumnDefinition Width="32"/>  <!-- Icon -->
            <ColumnDefinition Width="*"/>   <!-- Content -->
            <ColumnDefinition Width="Auto"/> <!-- Score -->
        </Grid.ColumnDefinitions>

        <!-- Selection Indicator - Removed per user request -->

        <!-- Checkbox - Simple approach, let it handle its own clicks -->
        <CheckBox x:Name="SelectionCheckBox"
                  Grid.Column="0"
                  VerticalAlignment="Center"
                  HorizontalAlignment="Center"
                  MinWidth="32"
                  MinHeight="32"
                  IsChecked="{x:Bind IsSelected, Mode=TwoWay}"
                  Click="OnCheckboxClick"/>
        
        <!-- Workflow Icon -->
        <FontIcon Grid.Column="1" 
                  VerticalAlignment="Center"
                  FontSize="18"
                  Foreground="{ThemeResource SystemFillColorAttentionBrush}"
                  Glyph="{x:Bind GetWorkflowGlyph(WorkflowType), Mode=OneWay}"/>

        <!-- Main Content -->
        <StackPanel Grid.Column="2" 
                    VerticalAlignment="Center"
                    Margin="8,0,16,0">
            
            <!-- First Line: Evaluation Name • Item count • Time -->
            <TextBlock TextTrimming="CharacterEllipsis"
                       FontSize="14">
                <Run Text="{x:Bind EvaluationName}"/>
                <Run Text=" • " Opacity="0.6"/>
                <Run Text="{x:Bind ItemCount}" Opacity="0.6"/>
                <Run Text=" items • " Opacity="0.6"/>
                <Run Text="{x:Bind GetFormattedDate(Timestamp), Mode=OneWay}" Opacity="0.6"/>
            </TextBlock>
            
            <!-- Second Line: Model and Criteria -->
            <TextBlock FontSize="12"
                       TextTrimming="CharacterEllipsis"
                       Margin="0,2,0,0">
                <Run Text="Model" FontWeight="Bold"/>
                <Run Text=": "/>
                <Run Text="{x:Bind ModelName}"/>
                <Run Text=" • " Opacity="0.6"/>
                <Run Text="Criteria" FontWeight="Bold"/>
                <Run Text=": "/>
                <Run Text="{x:Bind GetCriteriaDisplay(), Mode=OneWay}"/>
            </TextBlock>
        </StackPanel>

        <!-- Score Badge (for completed evaluations) -->
        <StackPanel Grid.Column="3" 
                    Orientation="Horizontal" 
                    Spacing="8"
                    VerticalAlignment="Center"
                    Visibility="{x:Bind IsCompleted, Converter={StaticResource BoolToVisibilityConverter}, Mode=OneWay}">
            
            <TextBlock Text="{x:Bind AverageScore}" 
                       FontWeight="Bold" 
                       FontSize="18"
                       VerticalAlignment="Center"/>
            
            <TextBlock Text="{x:Bind GetStarRating(AverageScore), Mode=OneWay}" 
                       Foreground="{ThemeResource SystemFillColorAttentionBrush}" 
                       FontSize="14"
                       FontFamily="Segoe UI Emoji"
                       VerticalAlignment="Center"/>
        </StackPanel>

        <!-- Progress Bar (for running evaluations) -->
        <Grid Grid.Column="3"
              Width="120"
              VerticalAlignment="Center"
              Visibility="{x:Bind IsRunning, Converter={StaticResource BoolToVisibilityConverter}, Mode=OneWay}">
            
            <ProgressBar Value="{x:Bind GetProgressValue(RunningProgress), Mode=OneWay}" 
                         Maximum="100"
                         Height="6"/>
            
            <TextBlock Text="{x:Bind GetProgressText(RunningProgress), Mode=OneWay}"
                       HorizontalAlignment="Center"
                       FontSize="11"
                       Margin="0,-16,0,0"/>
        </Grid>

        <!-- Visual States are handled in code-behind via GetRowBackground binding -->
    </Grid>
</UserControl>