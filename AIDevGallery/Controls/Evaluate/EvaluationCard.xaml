<UserControl
    x:Class="AIDevGallery.Controls.Evaluate.EvaluationCard"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    mc:Ignorable="d">

    <UserControl.Resources>
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <ResourceDictionary Source="/Styles/Evaluate/EvaluationCardStyles.xaml"/>
            </ResourceDictionary.MergedDictionaries>
        </ResourceDictionary>
    </UserControl.Resources>

    <Border x:Name="CardBorder" 
            Style="{StaticResource EvaluationCardStyle}"
            PointerEntered="OnPointerEntered"
            PointerExited="OnPointerExited"
            Tapped="OnCardTapped">
        
        <Border.RenderTransform>
            <CompositeTransform/>
        </Border.RenderTransform>
        
        <Border.Shadow>
            <ThemeShadow />
        </Border.Shadow>
        
        <Grid>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>
            
            <!-- Score Progress Box -->
            <Border x:Name="ScoreBox" 
                    Grid.Column="0"
                    Style="{StaticResource ScoreProgressBoxStyle}">
                <Border.Background>
                    <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                        <GradientStop x:Name="GradientStart" Offset="0"/>
                        <GradientStop x:Name="GradientEnd" Offset="1"/>
                    </LinearGradientBrush>
                </Border.Background>
                
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>
                    
                    <!-- Score Display -->
                    <TextBlock x:Name="ScoreText"
                              Grid.Row="0"
                              Style="{StaticResource ScoreTextStyle}"
                              Text="{x:Bind ViewModel.ScoreDisplay, Mode=OneWay}"/>
                    
                    <!-- Star Rating -->
                    <TextBlock x:Name="StarRating"
                              Grid.Row="1"
                              Style="{StaticResource StarRatingStyle}"
                              Text="{x:Bind ViewModel.StarRating, Mode=OneWay}"/>
                    
                    <!-- Mini Progress Bar -->
                    <ProgressBar x:Name="MiniProgress"
                                Grid.Row="2"
                                Height="4"
                                Margin="8,4,8,8"
                                Foreground="White"
                                Background="#33FFFFFF"
                                Value="{x:Bind ViewModel.ProgressPercentage, Mode=OneWay}"/>
                </Grid>
            </Border>
            
            <!-- Content Area -->
            <StackPanel Grid.Column="1" VerticalAlignment="Center">
                <!-- Title Row -->
                <StackPanel Orientation="Horizontal" Spacing="12">
                    <TextBlock Text="{x:Bind ViewModel.ModelName, Mode=OneWay}"
                              Style="{StaticResource CardTitleStyle}"/>
                    <TextBlock Text="{x:Bind ViewModel.Name, Mode=OneWay}"
                              Style="{StaticResource CardSubtitleStyle}"/>
                </StackPanel>
                
                <!-- Dataset Info -->
                <TextBlock Text="{x:Bind ViewModel.DatasetDescription, Mode=OneWay}"
                          Style="{StaticResource CardSubtitleStyle}"
                          Margin="0,4,0,0"/>
                
                <!-- Status Line -->
                <StackPanel Orientation="Horizontal" Spacing="8" Margin="0,8,0,0">
                    <TextBlock Text="{x:Bind ViewModel.StatusIcon, Mode=OneWay}"
                              FontSize="14"/>
                    <TextBlock Text="{x:Bind ViewModel.StatusText, Mode=OneWay}"
                              Style="{StaticResource CardCaptionStyle}"/>
                    <TextBlock Text="•" 
                              Style="{StaticResource CardCaptionStyle}"
                              Foreground="{ThemeResource TextFillColorDisabledBrush}"/>
                    <TextBlock Text="{x:Bind ViewModel.TimeDisplay, Mode=OneWay}"
                              Style="{StaticResource CardCaptionStyle}"/>
                    <TextBlock Text="•" 
                              Style="{StaticResource CardCaptionStyle}"
                              Foreground="{ThemeResource TextFillColorDisabledBrush}"
                              Visibility="{x:Bind ViewModel.DurationDisplay, Converter={StaticResource StringToVisibilityConverter}, Mode=OneWay}"/>
                    <TextBlock Text="{x:Bind ViewModel.DurationDisplay, Mode=OneWay}"
                              Style="{StaticResource CardCaptionStyle}"/>
                </StackPanel>
                
                <!-- Criteria Scores -->
                <Grid Margin="0,12,0,0">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>
                    
                    <TextBlock Grid.Row="0" 
                              Text="{x:Bind FormatCriteriaLabel(ViewModel.CriteriaNames), Mode=OneWay}"
                              Style="{StaticResource CardCaptionStyle}"
                              FontWeight="SemiBold"/>
                    <TextBlock Grid.Row="1" 
                              Text="{x:Bind FormatScoresLabel(ViewModel.CriteriaScoresDisplay), Mode=OneWay}"
                              Style="{StaticResource CardSubtitleStyle}"
                              Margin="0,2,0,0"/>
                </Grid>
                
                <!-- Running Progress (only for Test/Evaluate workflows) -->
                <ProgressBar Visibility="{x:Bind ViewModel.ShowProgress, Converter={StaticResource BoolToVisibilityConverter}, Mode=OneWay}"
                            Value="{x:Bind ViewModel.RunningProgress, Mode=OneWay}"
                            IsIndeterminate="{x:Bind IsProgressIndeterminate(ViewModel.RunningProgress), Mode=OneWay}"
                            Margin="0,8,0,0"
                            Height="4"/>
            </StackPanel>
            
            <!-- Action Buttons -->
            <StackPanel x:Name="ActionButtons" 
                       Grid.Column="2" 
                       Orientation="Horizontal"
                       VerticalAlignment="Center"
                       Opacity="0">
                
                <Button Style="{StaticResource CardActionButtonStyle}"
                       Click="OnViewClick"
                       ToolTipService.ToolTip="View Details">
                    <FontIcon Glyph="&#xE1A5;" FontSize="16"/>
                </Button>
                
                <Button Style="{StaticResource CardActionButtonStyle}"
                       Click="OnDeleteClick"
                       ToolTipService.ToolTip="Delete">
                    <FontIcon Glyph="&#xE107;" FontSize="16" 
                             Foreground="{ThemeResource SystemFillColorCriticalBrush}"/>
                </Button>
            </StackPanel>
        </Grid>
        
        <!-- Selection Indicator -->
        <Border x:Name="SelectionIndicator"
               Visibility="{x:Bind ViewModel.IsSelected, Converter={StaticResource BoolToVisibilityConverter}, Mode=OneWay}"
               Background="{ThemeResource AccentFillColorDefaultBrush}"
               Width="4"
               HorizontalAlignment="Left"
               CornerRadius="2,0,0,2"/>
    </Border>
</UserControl>