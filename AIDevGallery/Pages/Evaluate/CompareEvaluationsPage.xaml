<!--
Copyright (c) Microsoft Corporation.
Licensed under the MIT License.
-->
<Page
    x:Class="AIDevGallery.Pages.Evaluate.CompareEvaluationsPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="using:AIDevGallery.Pages.Evaluate"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    mc:Ignorable="d">

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Header -->
        <Grid Grid.Row="0" Padding="36,24,36,0">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>

            <!-- Breadcrumb -->
            <StackPanel Grid.Row="0" Orientation="Horizontal" Spacing="8">
                <Button x:Name="BackButton" 
                        Click="BackButton_Click"
                        Style="{StaticResource SubtleButtonStyle}">
                    <StackPanel Orientation="Horizontal" Spacing="4">
                        <FontIcon Glyph="&#xE72B;" FontSize="16" VerticalAlignment="Center"/>
                        <TextBlock Text="Evaluations" VerticalAlignment="Center"/>
                    </StackPanel>
                </Button>
                <TextBlock Text=">" VerticalAlignment="Center" Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                <TextBlock Text="Compare" VerticalAlignment="Center" Style="{StaticResource BodyTextBlockStyle}"/>
            </StackPanel>

            <!-- Title and subtitle -->
            <TextBlock Grid.Row="1" Text="Compare Evaluations" 
                       Style="{StaticResource TitleTextBlockStyle}" 
                       Margin="0,12,0,4"/>
            <TextBlock Grid.Row="2" x:Name="ComparisonSubtitle" 
                       Style="{StaticResource BodyTextBlockStyle}"
                       Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>

        </Grid>

        <!-- Content -->
        <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto">
            <Grid Padding="36,24,36,36">
                <StackPanel MaxWidth="1000" Spacing="12">
                    
                    <!-- Loading indicator -->
                    <Grid x:Name="LoadingPanel" Visibility="Visible" MinHeight="400">
                        <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center" Spacing="12">
                            <ProgressRing IsActive="True" Width="48" Height="48"/>
                            <TextBlock Text="Loading evaluations..." 
                                       Style="{StaticResource CaptionTextBlockStyle}"
                                       Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                        </StackPanel>
                    </Grid>

                    <!-- Content panel -->
                    <StackPanel x:Name="ContentPanel" Visibility="Collapsed" Spacing="12">

                        <!-- Criteria Score Comparison Chart -->
                        <Grid Style="{StaticResource CardGridStyle}">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="*"/>
                            </Grid.RowDefinitions>

                            <!-- Chart header with title and buttons -->
                            <Grid Grid.Row="0" Margin="0,0,0,12">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                
                                <TextBlock Grid.Column="0" 
                                           Text="Criteria Score Comparison"
                                           Style="{StaticResource SubtitleTextBlockStyle}"/>
                                
                                <StackPanel Grid.Column="1" 
                                            Orientation="Horizontal" 
                                            Spacing="4">
                                    <Button x:Name="CopyChartButton"
                                            Click="CopyChart_Click"
                                            ToolTipService.ToolTip="Copy chart to clipboard"
                                            AutomationProperties.Name="Copy chart to clipboard"
                                            Style="{StaticResource SubtleButtonStyle}">
                                        <FontIcon Glyph="&#xE8C8;" FontSize="14"/>
                                    </Button>
                                    <Button x:Name="SaveChartButton"
                                            Click="SaveChart_Click"
                                            ToolTipService.ToolTip="Save chart as image"
                                            AutomationProperties.Name="Save chart as image"
                                            Style="{StaticResource SubtleButtonStyle}">
                                        <FontIcon Glyph="&#xE74E;" FontSize="14"/>
                                    </Button>
                                </StackPanel>
                            </Grid>

                            <!-- Chart container -->
                            <Grid Grid.Row="1" x:Name="ChartContainer" MinHeight="400" Padding="16,8,16,16">
                                <Canvas x:Name="ComparisonChart" 
                                        HorizontalAlignment="Stretch"
                                        VerticalAlignment="Stretch"
                                        Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"/>
                            </Grid>
                        </Grid>

                        <!-- Model Rankings -->
                        <Grid Style="{StaticResource CardGridStyle}">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="*"/>
                            </Grid.RowDefinitions>

                            <TextBlock Grid.Row="0" Text="Model Rankings" 
                                       Style="{StaticResource SubtitleTextBlockStyle}"
                                       Margin="0,0,0,12"/>

                            <ItemsRepeater Grid.Row="1" x:Name="ModelRankingsRepeater">
                                <ItemsRepeater.Layout>
                                    <StackLayout Spacing="8"/>
                                </ItemsRepeater.Layout>
                                <ItemsRepeater.ItemTemplate>
                                    <DataTemplate>
                                        <Grid Style="{StaticResource CardGridStyle}" Padding="16">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="Auto"/>
                                                <ColumnDefinition Width="*"/>
                                            </Grid.ColumnDefinitions>

                                            <TextBlock Grid.Column="0" 
                                                       Text="{Binding RankEmoji}" 
                                                       FontSize="32"
                                                       Margin="0,0,16,0"
                                                       VerticalAlignment="Center"/>

                                            <StackPanel Grid.Column="1" Spacing="4">
                                                <TextBlock Text="{Binding ModelName}" 
                                                           Style="{StaticResource BodyStrongTextBlockStyle}"/>
                                                <TextBlock>
                                                    <Run Text="Overall Average:"/>
                                                    <Run Text="{Binding OverallAverage}" FontWeight="SemiBold"/>
                                                    <Run Text="/5.0"/>
                                                </TextBlock>
                                                <TextBlock>
                                                    <Run Text="Criteria Evaluated:"/>
                                                    <Run Text="{Binding CriteriaCount}"/>
                                                </TextBlock>
                                                <TextBlock>
                                                    <Run Text="Best in:"/>
                                                    <Run Text="{Binding WinCount}" FontWeight="SemiBold"/>
                                                    <Run Text=" criteria"/>
                                                </TextBlock>
                                            </StackPanel>
                                        </Grid>
                                    </DataTemplate>
                                </ItemsRepeater.ItemTemplate>
                            </ItemsRepeater>
                        </Grid>

                        <!-- Key Statistics -->
                        <Grid Style="{StaticResource CardGridStyle}">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="*"/>
                            </Grid.RowDefinitions>

                            <TextBlock Grid.Row="0" Text="Key Statistics" 
                                       Style="{StaticResource SubtitleTextBlockStyle}"
                                       Margin="0,0,0,12"/>

                            <Grid Grid.Row="1">
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>

                                <!-- Consistency -->
                                <Grid Grid.Row="0" Grid.Column="0" Style="{StaticResource CardGridStyle}" Margin="0,0,4,4">
                                    <StackPanel Spacing="4">
                                        <TextBlock Text="Consistency" Style="{StaticResource BodyStrongTextBlockStyle}"/>
                                        <TextBlock x:Name="ConsistencyText" Style="{StaticResource BodyTextBlockStyle}"/>
                                    </StackPanel>
                                </Grid>

                                <!-- Best Performer -->
                                <Grid Grid.Row="0" Grid.Column="1" Style="{StaticResource CardGridStyle}" Margin="4,0,0,4">
                                    <StackPanel Spacing="4">
                                        <TextBlock Text="Best Performer" Style="{StaticResource BodyStrongTextBlockStyle}"/>
                                        <TextBlock x:Name="BestPerformerText" Style="{StaticResource BodyTextBlockStyle}"/>
                                    </StackPanel>
                                </Grid>

                                <!-- Most Agreement -->
                                <Grid Grid.Row="1" Grid.Column="0" Style="{StaticResource CardGridStyle}" Margin="0,4,4,0">
                                    <StackPanel Spacing="4">
                                        <TextBlock Text="Most Agreement" Style="{StaticResource BodyStrongTextBlockStyle}"/>
                                        <TextBlock x:Name="MostAgreementText" Style="{StaticResource BodyTextBlockStyle}"/>
                                    </StackPanel>
                                </Grid>

                                <!-- Evaluation Coverage -->
                                <Grid Grid.Row="1" Grid.Column="1" Style="{StaticResource CardGridStyle}" Margin="4,4,0,0">
                                    <StackPanel Spacing="4">
                                        <TextBlock Text="Evaluation Coverage" Style="{StaticResource BodyStrongTextBlockStyle}"/>
                                        <TextBlock x:Name="EvaluationCoverageText" Style="{StaticResource BodyTextBlockStyle}"/>
                                    </StackPanel>
                                </Grid>
                            </Grid>
                        </Grid>

                        <!-- Detailed Comparison Table -->
                        <Expander x:Name="DetailedScoresExpander" 
                                  Header="View Detailed Scores"
                                  HorizontalAlignment="Stretch">
                            <Grid Style="{StaticResource CardGridStyle}" Margin="0,8,0,0">
                                <ScrollViewer HorizontalScrollBarVisibility="Auto">
                                    <Grid x:Name="DetailedScoresGrid" MinWidth="600">
                                        <!-- Table will be generated dynamically -->
                                    </Grid>
                                </ScrollViewer>
                            </Grid>
                        </Expander>

                        <!-- Coming Soon Section -->
                        <Grid Style="{StaticResource CardGridStyle}" Padding="24">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="*"/>
                            </Grid.RowDefinitions>

                            <TextBlock Grid.Row="0" Text="🚀 More Insights Coming Soon" 
                                       Style="{StaticResource SubtitleTextBlockStyle}"
                                       HorizontalAlignment="Center"
                                       Margin="0,0,0,16"/>
                            
                            <TextBlock Grid.Row="1" 
                                       Text="We're working on advanced features to help you get even more value from your evaluations"
                                       Style="{StaticResource CaptionTextBlockStyle}"
                                       Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                                       TextAlignment="Center"
                                       TextWrapping="Wrap"
                                       MaxWidth="600"
                                       HorizontalAlignment="Center"
                                       Margin="0,0,0,24"/>

                            <Grid Grid.Row="2">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>
                                
                                <!-- Left column -->
                                <Border Grid.Row="0" Grid.Column="0" 
                                        Background="{ThemeResource CardBackgroundFillColorSecondaryBrush}"
                                        CornerRadius="8"
                                        Padding="16"
                                        Margin="0,0,8,8">
                                    <StackPanel>
                                        <TextBlock Text="📊" FontSize="24" HorizontalAlignment="Center" Margin="0,0,0,8"/>
                                        <TextBlock Text="Statistical Analysis" Style="{StaticResource BodyStrongTextBlockStyle}" HorizontalAlignment="Center" Margin="0,0,0,4"/>
                                        <TextBlock Text="Significance testing and confidence intervals" 
                                                   Style="{StaticResource CaptionTextBlockStyle}"
                                                   TextAlignment="Center"
                                                   TextWrapping="Wrap"/>
                                    </StackPanel>
                                </Border>
                                
                                <Border Grid.Row="0" Grid.Column="1" 
                                        Background="{ThemeResource CardBackgroundFillColorSecondaryBrush}"
                                        CornerRadius="8"
                                        Padding="16"
                                        Margin="8,0,0,8">
                                    <StackPanel>
                                        <TextBlock Text="💰" FontSize="24" HorizontalAlignment="Center" Margin="0,0,0,8"/>
                                        <TextBlock Text="Cost Analysis" Style="{StaticResource BodyStrongTextBlockStyle}" HorizontalAlignment="Center" Margin="0,0,0,4"/>
                                        <TextBlock Text="Compare efficiency and value across models" 
                                                   Style="{StaticResource CaptionTextBlockStyle}"
                                                   TextAlignment="Center"
                                                   TextWrapping="Wrap"/>
                                    </StackPanel>
                                </Border>
                                
                                <Border Grid.Row="1" Grid.Column="0" 
                                        Background="{ThemeResource CardBackgroundFillColorSecondaryBrush}"
                                        CornerRadius="8"
                                        Padding="16"
                                        Margin="0,8,8,8">
                                    <StackPanel>
                                        <TextBlock Text="⚡" FontSize="24" HorizontalAlignment="Center" Margin="0,0,0,8"/>
                                        <TextBlock Text="Performance Metrics" Style="{StaticResource BodyStrongTextBlockStyle}" HorizontalAlignment="Center" Margin="0,0,0,4"/>
                                        <TextBlock Text="Latency, throughput, and reliability data" 
                                                   Style="{StaticResource CaptionTextBlockStyle}"
                                                   TextAlignment="Center"
                                                   TextWrapping="Wrap"/>
                                    </StackPanel>
                                </Border>
                                
                                <Border Grid.Row="1" Grid.Column="1" 
                                        Background="{ThemeResource CardBackgroundFillColorSecondaryBrush}"
                                        CornerRadius="8"
                                        Padding="16"
                                        Margin="8,8,0,8">
                                    <StackPanel>
                                        <TextBlock Text="🔄" FontSize="24" HorizontalAlignment="Center" Margin="0,0,0,8"/>
                                        <TextBlock Text="Historical Trends" Style="{StaticResource BodyStrongTextBlockStyle}" HorizontalAlignment="Center" Margin="0,0,0,4"/>
                                        <TextBlock Text="Track model improvements over time" 
                                                   Style="{StaticResource CaptionTextBlockStyle}"
                                                   TextAlignment="Center"
                                                   TextWrapping="Wrap"/>
                                    </StackPanel>
                                </Border>
                                
                                <Border Grid.Row="2" Grid.Column="0" 
                                        Background="{ThemeResource CardBackgroundFillColorSecondaryBrush}"
                                        CornerRadius="8"
                                        Padding="16"
                                        Margin="0,8,8,8">
                                    <StackPanel>
                                        <TextBlock Text="🤖" FontSize="24" HorizontalAlignment="Center" Margin="0,0,0,8"/>
                                        <TextBlock Text="AI Recommendations" Style="{StaticResource BodyStrongTextBlockStyle}" HorizontalAlignment="Center" Margin="0,0,0,4"/>
                                        <TextBlock Text="Get actionable insights for your use case" 
                                                   Style="{StaticResource CaptionTextBlockStyle}"
                                                   TextAlignment="Center"
                                                   TextWrapping="Wrap"/>
                                    </StackPanel>
                                </Border>
                                
                                <Border Grid.Row="2" Grid.Column="1" 
                                        Background="{ThemeResource CardBackgroundFillColorSecondaryBrush}"
                                        CornerRadius="8"
                                        Padding="16"
                                        Margin="8,8,0,8">
                                    <StackPanel>
                                        <TextBlock Text="🎯" FontSize="24" HorizontalAlignment="Center" Margin="0,0,0,8"/>
                                        <TextBlock Text="Subset Analysis" Style="{StaticResource BodyStrongTextBlockStyle}" HorizontalAlignment="Center" Margin="0,0,0,4"/>
                                        <TextBlock Text="Deep dive into specific categories" 
                                                   Style="{StaticResource CaptionTextBlockStyle}"
                                                   TextAlignment="Center"
                                                   TextWrapping="Wrap"/>
                                    </StackPanel>
                                </Border>
                            </Grid>
                        </Grid>

                    </StackPanel>

                    <!-- Error state -->
                    <Grid x:Name="ErrorPanel" Visibility="Collapsed" MinHeight="400">
                        <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center" Spacing="12">
                            <FontIcon Glyph="&#xE783;" FontSize="48" 
                                      Foreground="{ThemeResource SystemFillColorCriticalBrush}"/>
                            <TextBlock x:Name="ErrorText" 
                                       Style="{StaticResource SubtitleTextBlockStyle}"
                                       TextAlignment="Center"/>
                            <Button Content="Go Back" Click="BackButton_Click" HorizontalAlignment="Center"/>
                        </StackPanel>
                    </Grid>

                </StackPanel>
            </Grid>
        </ScrollViewer>
        
        <!-- Sticky Actions Bar -->
        <Grid Grid.Row="2" 
              Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
              BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
              BorderThickness="0,1,0,0"
              Padding="24,12">
            <StackPanel Orientation="Horizontal" 
                        HorizontalAlignment="Right" 
                        Spacing="8">
                
                <Button x:Name="ExportDataButton"
                        AutomationProperties.Name="Export evaluation data"
                        ToolTipService.ToolTip="Export evaluation data">
                    <Button.Flyout>
                        <MenuFlyout>
                            <MenuFlyoutItem Text="Export as CSV" 
                                            Click="ExportCsv_Click">
                                <MenuFlyoutItem.Icon>
                                    <FontIcon Glyph="&#xE8B7;"/>
                                </MenuFlyoutItem.Icon>
                            </MenuFlyoutItem>
                            <MenuFlyoutItem Text="Export as JSON" 
                                            Click="ExportJson_Click">
                                <MenuFlyoutItem.Icon>
                                    <FontIcon Glyph="&#xE943;"/>
                                </MenuFlyoutItem.Icon>
                            </MenuFlyoutItem>
                        </MenuFlyout>
                    </Button.Flyout>
                    <StackPanel Orientation="Horizontal" Spacing="8">
                        <FontIcon Glyph="&#xE896;" FontSize="16"/>
                        <TextBlock Text="Export Data"/>
                    </StackPanel>
                </Button>
                
                <Button x:Name="PrintButton" Click="PrintInsights_Click"
                        AutomationProperties.Name="Print comparison report"
                        ToolTipService.ToolTip="Print comparison report">
                    <StackPanel Orientation="Horizontal" Spacing="8">
                        <FontIcon Glyph="&#xE749;" FontSize="16"/>
                        <TextBlock Text="Print Report"/>
                    </StackPanel>
                </Button>
            </StackPanel>
        </Grid>
    </Grid>
</Page>