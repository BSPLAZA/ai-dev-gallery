<?xml version="1.0" encoding="utf-8"?>
<Page
    x:Class="AIDevGallery.Pages.Evaluate.EvaluationInsightsPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    mc:Ignorable="d">

    <Page.Resources>
        <!-- Spacing between cards -->
        <x:Double x:Key="SettingsCardSpacing">4</x:Double>
    </Page.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/> <!-- Header -->
            <RowDefinition Height="*"/>    <!-- Content -->
            <RowDefinition Height="Auto"/> <!-- Actions Bar -->
        </Grid.RowDefinitions>
        
        <!-- Header -->
        <Grid Grid.Row="0" Padding="36,24,36,0">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>
            
            <!-- Breadcrumb Navigation -->
            <StackPanel Grid.Column="0" Orientation="Horizontal" Spacing="8">
                <Button x:Name="BackButton" 
                        Click="BackButton_Click"
                        Style="{StaticResource SubtleButtonStyle}"
                        VerticalAlignment="Center">
                    <StackPanel Orientation="Horizontal" Spacing="4">
                        <FontIcon Glyph="&#xE72B;" FontSize="16" VerticalAlignment="Center"/>
                        <TextBlock Text="Evaluations" VerticalAlignment="Center"/>
                    </StackPanel>
                </Button>
                <TextBlock Text=">" 
                           VerticalAlignment="Center"
                           Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                <TextBlock x:Name="EvaluationNameText" 
                           VerticalAlignment="Center"
                           Style="{StaticResource BodyTextBlockStyle}"/>
            </StackPanel>
        </Grid>
        
        <!-- Loading State -->
        <Grid x:Name="LoadingPanel" 
              Grid.Row="1" 
              Visibility="Visible">
            <StackPanel HorizontalAlignment="Center" 
                        VerticalAlignment="Center"
                        Spacing="12">
                <ProgressRing IsActive="True" Width="48" Height="48"/>
                <TextBlock Text="Loading evaluation insights..."
                           Style="{StaticResource CaptionTextBlockStyle}"
                           Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
            </StackPanel>
        </Grid>
        
        <!-- Main Content -->
        <ScrollViewer Grid.Row="1" 
                      x:Name="ContentScrollViewer"
                      Visibility="Collapsed"
                      VerticalScrollBarVisibility="Auto">
            <Grid Padding="36,24,36,36">
                <StackPanel MaxWidth="1000" 
                            HorizontalAlignment="Stretch"
                            Spacing="{StaticResource SettingsCardSpacing}">
                    
                    <!-- Evaluation Title and Metadata -->
                    <StackPanel Spacing="8">
                        <TextBlock x:Name="PageTitle" 
                                   Text="Evaluation Insights"
                                   Style="{StaticResource TitleTextBlockStyle}"/>
                        
                        <TextBlock x:Name="EvaluationTitle"
                                   Style="{StaticResource SubtitleTextBlockStyle}"
                                   TextWrapping="Wrap"/>
                        
                        <StackPanel Orientation="Horizontal" Spacing="16">
                            <TextBlock>
                                <Run Text="Model:" FontWeight="SemiBold"/>
                                <Run x:Name="ModelNameRun"/>
                            </TextBlock>
                            <TextBlock Text="|" Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                            <TextBlock>
                                <Run Text="Dataset:" FontWeight="SemiBold"/>
                                <Run x:Name="DatasetNameRun"/>
                            </TextBlock>
                            <TextBlock Text="|" Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                            <TextBlock x:Name="TimestampText"/>
                        </StackPanel>
                        
                        <StackPanel Orientation="Horizontal" Spacing="16">
                            <StackPanel Orientation="Horizontal" Spacing="4">
                                <TextBlock Text="Status:" FontWeight="SemiBold"/>
                                <FontIcon x:Name="StatusIcon" 
                                          Glyph="&#xE73E;" 
                                          FontSize="16"
                                          Foreground="{ThemeResource SystemFillColorSuccessBrush}"/>
                                <TextBlock x:Name="StatusText"/>
                            </StackPanel>
                            <TextBlock Text="|" Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                            <StackPanel Orientation="Horizontal" Spacing="4">
                                <TextBlock Text="Overall Score:" FontWeight="SemiBold"/>
                                <TextBlock x:Name="StarRatingText" FontFamily="Segoe UI Symbol"/>
                                <TextBlock x:Name="ScoreText"/>
                            </StackPanel>
                        </StackPanel>
                    </StackPanel>
                    
                    <!-- Metric Cards -->
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        
                        <!-- Images Processed Card -->
                        <Grid Grid.Column="0" 
                              Style="{StaticResource CardGridStyle}"
                              Margin="0,0,4,0">
                            <StackPanel Spacing="4">
                                <TextBlock Text="Images Processed" 
                                           Style="{StaticResource CaptionTextBlockStyle}"
                                           Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                                <TextBlock x:Name="ImagesProcessedText" 
                                           Style="{StaticResource SubtitleTextBlockStyle}"
                                           FontWeight="SemiBold"/>
                                <TextBlock x:Name="ProcessingStatusText" 
                                           Style="{StaticResource CaptionTextBlockStyle}"
                                           Foreground="{ThemeResource SystemFillColorSuccessBrush}"/>
                            </StackPanel>
                        </Grid>
                        
                        <!-- Average Score Card -->
                        <Grid Grid.Column="1" 
                              Style="{StaticResource CardGridStyle}"
                              Margin="4,0,4,0">
                            <StackPanel Spacing="4">
                                <TextBlock Text="Average Score" 
                                           Style="{StaticResource CaptionTextBlockStyle}"
                                           Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                                <TextBlock x:Name="AverageScoreText" 
                                           Style="{StaticResource SubtitleTextBlockStyle}"
                                           FontWeight="SemiBold"/>
                            </StackPanel>
                        </Grid>
                        
                        <!-- Criteria Evaluated Card -->
                        <Grid Grid.Column="2" 
                              Style="{StaticResource CardGridStyle}"
                              Margin="4,0,4,0">
                            <StackPanel Spacing="4">
                                <TextBlock Text="Criteria Evaluated" 
                                           Style="{StaticResource CaptionTextBlockStyle}"
                                           Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                                <TextBlock x:Name="CriteriaCountText" 
                                           Style="{StaticResource SubtitleTextBlockStyle}"
                                           FontWeight="SemiBold"/>
                            </StackPanel>
                        </Grid>
                        
                        <!-- Duration Card -->
                        <Grid Grid.Column="3" 
                              Style="{StaticResource CardGridStyle}"
                              Margin="4,0,0,0">
                            <StackPanel Spacing="4">
                                <TextBlock Text="Duration" 
                                           Style="{StaticResource CaptionTextBlockStyle}"
                                           Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                                <TextBlock x:Name="DurationText" 
                                           Style="{StaticResource SubtitleTextBlockStyle}"
                                           FontWeight="SemiBold"/>
                            </StackPanel>
                        </Grid>
                    </Grid>
                    
                    <!-- View Switcher -->
                    <StackPanel Orientation="Horizontal" Spacing="4">
                        <ToggleButton x:Name="ChartViewToggle" 
                                      IsChecked="True"
                                      Click="ViewToggle_Click">
                            <StackPanel Orientation="Horizontal" Spacing="8">
                                <FontIcon Glyph="&#xE8A1;" FontSize="16"/>
                                <TextBlock Text="Chart"/>
                            </StackPanel>
                        </ToggleButton>
                        
                        <ToggleButton x:Name="TableViewToggle" 
                                      Click="ViewToggle_Click">
                            <StackPanel Orientation="Horizontal" Spacing="8">
                                <FontIcon Glyph="&#xE8A5;" FontSize="16"/>
                                <TextBlock Text="Table"/>
                            </StackPanel>
                        </ToggleButton>
                        
                        <ToggleButton x:Name="FolderViewToggle" 
                                      Click="ViewToggle_Click"
                                      Visibility="{x:Bind _viewModel.HasFolderStatistics, Mode=OneWay}">
                            <StackPanel Orientation="Horizontal" Spacing="8">
                                <FontIcon Glyph="&#xE8B7;" FontSize="16"/>
                                <TextBlock Text="Folders"/>
                            </StackPanel>
                        </ToggleButton>
                    </StackPanel>
                    
                    <!-- Criteria Visualization Container -->
                    <Grid x:Name="VisualizationContainer" 
                          MinHeight="400">
                        
                        <!-- Chart View -->
                        <Grid x:Name="ChartView" 
                              Visibility="Visible"
                              Style="{StaticResource CardGridStyle}">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="*"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>
                            
                            <!-- Chart Header with Controls -->
                            <Grid Grid.Row="0" Margin="16,16,16,8">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                
                                <TextBlock Grid.Column="0" 
                                           Text="Average Scores by Evaluation Criteria"
                                           Style="{StaticResource BodyStrongTextBlockStyle}"/>
                                
                                <StackPanel Grid.Column="1" 
                                            Orientation="Horizontal" 
                                            Spacing="4">
                                    <Button x:Name="CopyChartButton"
                                            Click="CopyChart_Click"
                                            ToolTipService.ToolTip="Copy chart to clipboard"
                                            Style="{StaticResource SubtleButtonStyle}">
                                        <FontIcon Glyph="&#xE8C8;" FontSize="14"/>
                                    </Button>
                                    <Button x:Name="SaveChartButton"
                                            Click="SaveChartAsImage_Click"
                                            ToolTipService.ToolTip="Save chart as image"
                                            Style="{StaticResource SubtleButtonStyle}">
                                        <FontIcon Glyph="&#xE74E;" FontSize="14"/>
                                    </Button>
                                </StackPanel>
                            </Grid>
                            
                            <!-- Chart Content -->
                            <Grid Grid.Row="1" x:Name="ChartContentGrid" Padding="16,8,16,16">
                                <!-- Chart will be dynamically created here -->
                            </Grid>
                            
                            <!-- Scale Legend -->
                            <Border Grid.Row="2" 
                                    Background="{ThemeResource LayerFillColorDefaultBrush}"
                                    BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                                    BorderThickness="0,1,0,0"
                                    Padding="16,8">
                                <TextBlock Style="{StaticResource CaptionTextBlockStyle}"
                                           Foreground="{ThemeResource TextFillColorSecondaryBrush}">
                                    <Run Text="Scale:"/>
                                    <Run Text="1-2.4 Needs Improvement" Foreground="#FF5722"/>
                                    <Run Text="|"/>
                                    <Run Text="2.5-3.4 Fair" Foreground="#FFC107"/>
                                    <Run Text="|"/>
                                    <Run Text="3.5-4.4 Good" Foreground="#2196F3"/>
                                    <Run Text="|"/>
                                    <Run Text="4.5-5.0 Excellent" Foreground="#4CAF50"/>
                                </TextBlock>
                            </Border>
                        </Grid>
                        
                        <!-- Table View -->
                        <Grid x:Name="TableView" 
                              Visibility="Collapsed"
                              Style="{StaticResource CardGridStyle}"
                              Padding="16">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="*"/>
                            </Grid.RowDefinitions>
                            
                            <TextBlock Grid.Row="0" 
                                       Text="Criteria Performance Details"
                                       Style="{StaticResource BodyStrongTextBlockStyle}"
                                       Margin="0,0,0,16"/>
                            
                            <ScrollViewer Grid.Row="1">
                                <ItemsRepeater x:Name="CriteriaTableRepeater">
                                    <ItemsRepeater.Layout>
                                        <StackLayout Spacing="4"/>
                                    </ItemsRepeater.Layout>
                                    <ItemsRepeater.ItemTemplate>
                                        <DataTemplate>
                                            <Grid Style="{StaticResource CardGridStyle}"
                                                  Padding="12">
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="*"/>
                                                    <ColumnDefinition Width="80"/>
                                                    <ColumnDefinition Width="100"/>
                                                </Grid.ColumnDefinitions>
                                                
                                                <TextBlock Grid.Column="0" 
                                                           Text="{Binding Name}"
                                                           VerticalAlignment="Center"/>
                                                
                                                <TextBlock Grid.Column="1" 
                                                           Text="{Binding ScoreText}"
                                                           HorizontalAlignment="Center"
                                                           VerticalAlignment="Center"
                                                           FontWeight="SemiBold"/>
                                                
                                                <Border Grid.Column="2" 
                                                        Background="{Binding StatusBrush}"
                                                        CornerRadius="4"
                                                        Padding="8,4"
                                                        HorizontalAlignment="Right">
                                                    <StackPanel Orientation="Horizontal" Spacing="4">
                                                        <FontIcon Glyph="{Binding StatusGlyph}" 
                                                                  FontSize="12"/>
                                                        <TextBlock Text="{Binding StatusText}" 
                                                                   FontSize="12"
                                                                   FontWeight="SemiBold"/>
                                                    </StackPanel>
                                                </Border>
                                            </Grid>
                                        </DataTemplate>
                                    </ItemsRepeater.ItemTemplate>
                                </ItemsRepeater>
                            </ScrollViewer>
                        </Grid>
                        
                        <!-- Folder View -->
                        <Grid x:Name="FolderView" 
                              Visibility="Collapsed"
                              Style="{StaticResource CardGridStyle}"
                              Padding="16">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="*"/>
                            </Grid.RowDefinitions>
                            
                            <TextBlock Grid.Row="0" 
                                       Text="Performance by Folder"
                                       Style="{StaticResource BodyStrongTextBlockStyle}"
                                       Margin="0,0,0,16"/>
                            
                            <ScrollViewer Grid.Row="1">
                                <ItemsRepeater x:Name="FolderStatsRepeater">
                                    <ItemsRepeater.Layout>
                                        <StackLayout Spacing="4"/>
                                    </ItemsRepeater.Layout>
                                    <ItemsRepeater.ItemTemplate>
                                        <DataTemplate>
                                            <Grid Style="{StaticResource CardGridStyle}"
                                                  Padding="12">
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="Auto"/>
                                                    <ColumnDefinition Width="*"/>
                                                    <ColumnDefinition Width="Auto"/>
                                                    <ColumnDefinition Width="Auto"/>
                                                </Grid.ColumnDefinitions>
                                                
                                                <FontIcon Grid.Column="0" 
                                                          Glyph="&#xE8B7;" 
                                                          FontSize="16"
                                                          Margin="0,0,12,0"
                                                          VerticalAlignment="Center"/>
                                                
                                                <TextBlock Grid.Column="1" 
                                                           Text="{Binding FolderPath}"
                                                           VerticalAlignment="Center"/>
                                                
                                                <TextBlock Grid.Column="2" 
                                                           Text="{Binding ItemCountText}" 
                                                           Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                                                           Margin="0,0,12,0"
                                                           VerticalAlignment="Center"/>
                                                
                                                <Border Grid.Column="3" 
                                                        Background="{Binding ScoreBrush}"
                                                        CornerRadius="4"
                                                        Padding="12,6">
                                                    <TextBlock Text="{Binding AverageScoreText}" 
                                                               FontWeight="SemiBold"
                                                               Foreground="White"/>
                                                </Border>
                                            </Grid>
                                        </DataTemplate>
                                    </ItemsRepeater.ItemTemplate>
                                </ItemsRepeater>
                            </ScrollViewer>
                        </Grid>
                        
                    </Grid>
                    
                    <!-- Statistical Summary (shown when detailed data available) -->
                    <Grid x:Name="StatisticalSummaryCard" 
                          Style="{StaticResource CardGridStyle}"
                          Visibility="Collapsed"
                          Padding="0">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/> <!-- Header -->
                            <RowDefinition Height="Auto"/> <!-- Stats -->
                        </Grid.RowDefinitions>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        
                        <!-- Stats will be added programmatically -->
                    </Grid>
                    
                    <!-- Image Preview Area (Future Enhancement) -->
                    <Grid x:Name="ImagePreviewArea" 
                          Style="{StaticResource CardGridStyle}"
                          Visibility="Collapsed"
                          MinHeight="400">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="300"/> <!-- File navigation -->
                            <ColumnDefinition Width="*"/>   <!-- Preview and details -->
                        </Grid.ColumnDefinitions>
                        
                        <!-- Left: File Navigation -->
                        <Grid Grid.Column="0" 
                              Background="{ThemeResource LayerFillColorDefaultBrush}"
                              BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                              BorderThickness="0,0,1,0">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="*"/>
                            </Grid.RowDefinitions>
                            
                            <TextBlock Grid.Row="0" 
                                       Text="Image Results" 
                                       Style="{StaticResource BodyStrongTextBlockStyle}"
                                       Margin="16"/>
                            
                            <!-- File list will be added when individual results are available -->
                            <TextBlock Grid.Row="1" 
                                       Text="Individual image results will be displayed here when available"
                                       Style="{StaticResource CaptionTextBlockStyle}"
                                       Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                                       TextWrapping="Wrap"
                                       Margin="16"
                                       VerticalAlignment="Center"
                                       HorizontalAlignment="Center"
                                       TextAlignment="Center"/>
                        </Grid>
                        
                        <!-- Right: Image Preview and Metadata -->
                        <Grid Grid.Column="1" Padding="24">
                            <StackPanel Spacing="16">
                                <TextBlock Text="Select an image from the left to view details"
                                           Style="{StaticResource BodyTextBlockStyle}"
                                           Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                                           HorizontalAlignment="Center"
                                           VerticalAlignment="Center"/>
                            </StackPanel>
                        </Grid>
                    </Grid>
                    
                </StackPanel>
            </Grid>
        </ScrollViewer>
        
        <!-- Empty State -->
        <Grid x:Name="EmptyStatePanel" 
              Grid.Row="1" 
              Visibility="Collapsed"
              HorizontalAlignment="Center" 
              VerticalAlignment="Center"
              MaxWidth="400">
            <StackPanel Spacing="12">
                <FontIcon Glyph="&#xE9CE;" 
                          FontSize="48"
                          Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                          HorizontalAlignment="Center"/>
                
                <TextBlock Text="No evaluation data available"
                           Style="{StaticResource SubtitleTextBlockStyle}"
                           HorizontalAlignment="Center"/>
                
                <TextBlock Text="This evaluation doesn't have any results to display."
                           Style="{StaticResource BodyTextBlockStyle}"
                           Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                           TextAlignment="Center"
                           TextWrapping="Wrap"/>
            </StackPanel>
        </Grid>
        
        <!-- Sticky Actions Bar -->
        <Grid Grid.Row="2" 
              x:Name="ActionsBar"
              Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
              BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
              BorderThickness="0,1,0,0"
              Padding="24,12">
            <StackPanel Orientation="Horizontal" 
                        HorizontalAlignment="Right" 
                        Spacing="8">
                
                <Button x:Name="ExportDataButton" Click="ExportData_Click">
                    <Button.Flyout>
                        <MenuFlyout>
                            <MenuFlyoutItem Text="Export as CSV" Click="ExportCsv_Click">
                                <MenuFlyoutItem.Icon>
                                    <FontIcon Glyph="&#xE8B7;"/>
                                </MenuFlyoutItem.Icon>
                            </MenuFlyoutItem>
                            <MenuFlyoutItem Text="Export as JSON" Click="ExportJson_Click">
                                <MenuFlyoutItem.Icon>
                                    <FontIcon Glyph="&#xE943;"/>
                                </MenuFlyoutItem.Icon>
                            </MenuFlyoutItem>
                        </MenuFlyout>
                    </Button.Flyout>
                    <StackPanel Orientation="Horizontal" Spacing="8">
                        <FontIcon Glyph="&#xE896;" FontSize="16"/>
                        <TextBlock Text="Export Data"/>
                    </StackPanel>
                </Button>
                
                <Button x:Name="ShareButton" 
                        Click="Share_Click"
                        IsEnabled="False"
                        ToolTipService.ToolTip="Coming soon">
                    <StackPanel Orientation="Horizontal" Spacing="8">
                        <FontIcon Glyph="&#xE72D;" FontSize="16"/>
                        <TextBlock Text="Share"/>
                    </StackPanel>
                </Button>
                
                <Button x:Name="PrintButton" Click="PrintReport_Click">
                    <StackPanel Orientation="Horizontal" Spacing="8">
                        <FontIcon Glyph="&#xE749;" FontSize="16"/>
                        <TextBlock Text="Print Report"/>
                    </StackPanel>
                </Button>
            </StackPanel>
        </Grid>
        
    </Grid>
</Page>